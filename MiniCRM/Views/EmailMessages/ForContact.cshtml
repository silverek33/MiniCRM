@model MiniCRM.Models.Contact
@{
    ViewData["Title"] = "Wiadomości: " + Model.FirstName + " " + Model.LastName;
}
<h2>@ViewData["Title"]</h2>

<div class="mb-3 d-flex gap-2">
    <a asp-action="Create" asp-route-contactId="@Model.Id" class="btn btn-primary">Wyślij wiadomość</a>

    <partial name="_BackButton" />
</div>

@if (TempData["Success"] is string success)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @success
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Zamknij"></button>
    </div>
}
@if (TempData["Error"] is string error)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @error
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Zamknij"></button>
    </div>
}

@if (!Model.EmailMessages.Any())
{
    <div class="alert alert-info">Brak wiadomości dla tego kontaktu.</div>
}
else
{
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>Data (UTC)</th>
                <th>Do</th>
                <th>Temat</th>
                <th>Wysłano</th>
                <th class="text-end">Akcje</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var m in Model.EmailMessages.OrderByDescending(x => x.CreatedUtc))
        {
            <tr>
                <td>@m.CreatedUtc.ToString("yyyy-MM-dd HH:mm")</td>
                <td>@m.To</td>
                <td>@m.Subject</td>
                <td>@(m.Sent ? "Tak" : "Nie")</td>
                <td class="text-end">
                    <form asp-action="Delete" asp-route-id="@m.Id" method="post" class="d-inline">
                        <input type="hidden" name="id" value="@m.Id" />
                        <button type="submit" class="btn btn-sm btn-outline-danger">Usuń</button>
                        @Html.AntiForgeryToken()
                    </form>
                </td>
            </tr>
        }
        </tbody>
    </table>
}